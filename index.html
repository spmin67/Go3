<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>퀴즈 결과 전송 앱</title>
    <style>
        body { font-family: 'Arial', sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; background-color: #f4f4f4; margin: 0; }
        .quiz-container { background-color: #fff; padding: 30px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); width: 90%; max-width: 500px; text-align: center; }
        .question { font-size: 1.2em; margin-bottom: 25px; color: #555; }
        .options-container { display: flex; flex-direction: column; gap: 10px; margin-bottom: 20px; }
        .option-button { background-color: #e0e0e0; border: none; padding: 12px; border-radius: 5px; cursor: pointer; transition: 0.3s; }
        .option-button:hover { background-color: #d0d0d0; }
        .option-button.selected { background-color: #a0e0a0; }
        .option-button.incorrect { background-color: #ff9999; }
        button { background-color: #007bff; color: white; border: none; padding: 12px 25px; border-radius: 5px; cursor: pointer; font-size: 1em; }
        button:disabled { background-color: #ccc; }
        input[type="text"] { padding: 10px; width: 80%; margin-bottom: 20px; border: 1px solid #ddd; border-radius: 5px; }
        #loading { color: #007bff; font-weight: bold; display: none; }
    </style>
</head>
<body>
    <div class="quiz-container">
        <h1 id="title">상식 퀴즈</h1>
        
        <div id="quiz-section">
            <p class="question" id="questionText">문제를 불러오는 중...</p>
            <div class="options-container" id="optionsContainer"></div>
            <button id="nextButton" style="display:none;">다음 문제</button>
            <button id="finishButton" style="display:none;">채점하기</button>
        </div>

        <div id="name-section" style="display:none;">
            <h2>수고하셨습니다!</h2>
            <p>이름을 입력하면 결과가 선생님께 전송됩니다.</p>
            <input type="text" id="studentName" placeholder="이름을 입력하세요">
            <br>
            <button id="submitButton">결과 전송하기</button>
            <p id="loading">전송 중...</p>
        </div>

        <div id="result-section" style="display:none;">
            <h2 id="finalScoreText"></h2>
            <p style="color: #28a745; font-weight: bold;">"결과를 쌤에게 전송했습니다!"</p>
            <button onclick="location.reload()">다시 시작</button>
        </div>
    </div>

    <script>
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzjmqaiopp7CG8QQx-GVU5X7sGhmbXhgXvnma7L39qm1_ddcfB3VEveNGT_9vK-qkWWPQ/exec";
        
        const questions = [
            { q: "대한민국의 수도는?", a: ["서울", "부산", "대구"], cor: "서울" },
            { q: "사과를 영어로 하면?", a: ["Banana", "Apple", "Grape"], cor: "Apple" },
            { q: "1+1은?", a: ["1", "2", "3"], cor: "2" }
        ];

        let currentIdx = 0;
        let score = 0;

        function loadQuestion() {
            const q = questions[currentIdx];
            document.getElementById('questionText').textContent = q.q;
            const container = document.getElementById('optionsContainer');
            container.innerHTML = '';
            
            q.a.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'option-button';
                btn.textContent = opt;
                btn.onclick = () => {
                    const btns = container.querySelectorAll('button');
                    btns.forEach(b => b.disabled = true);
                    if(opt === q.cor) {
                        btn.classList.add('selected');
                        score++;
                    } else {
                        btn.classList.add('incorrect');
                    }
                    
                    if(currentIdx < questions.length - 1) {
                        document.getElementById('nextButton').style.display = 'inline-block';
                    } else {
                        document.getElementById('finishButton').style.display = 'inline-block';
                    }
                };
                container.appendChild(btn);
            });
        }

        document.getElementById('nextButton').onclick = () => {
            currentIdx++;
            document.getElementById('nextButton').style.display = 'none';
            loadQuestion();
        };

        document.getElementById('finishButton').onclick = () => {
            document.getElementById('quiz-section').style.display = 'none';
            document.getElementById('name-section').style.display = 'block';
        };

        document.getElementById('submitButton').onclick = function() {
            const name = document.getElementById('studentName').value;
            if(!name) { alert("이름을 입력해주세요!"); return; }

            this.disabled = true;
            document.getElementById('loading').style.display = 'block';

            // 데이터 전송 (JSONP 방식 우회 또는 simple fetch)
            const params = new URLSearchParams({
                "시간": new Date().toLocaleString(),
                "학생이름": name,
                "점수": score + " / " + questions.length
            });

            fetch(`${SCRIPT_URL}?${params.toString()}`, { method: 'GET' })
                .then(() => {
                    document.getElementById('name-section').style.display = 'none';
                    document.getElementById('result-section').style.display = 'block';
                    document.getElementById('finalScoreText').textContent = `당신의 점수: ${score}점`;
                })
                .catch(err => {
                    alert("전송 중 오류가 발생했습니다. 하지만 결과는 화면에 표시합니다.");
                    console.error(err);
                });
        };

        loadQuestion();
    </script>
</body>
</html>